name: Draft Post Notification

on:
  push:
    branches:
      - drafts # ë“œë˜í”„íŠ¸ ê¸€ì„ ê´€ë¦¬í•˜ëŠ” ë¸Œëœì¹˜ ì´ë¦„
    paths:
      - 'posts/**.md' # ë“œë˜í”„íŠ¸ ê¸€ íŒŒì¼ ê²½ë¡œ íŒ¨í„´

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Check if it's a draft (ì˜ˆì‹œ: íŒŒì¼ ë‚´ìš© í™•ì¸)
        id: check_draft
        run: |
          # íŒŒì¼ ë‚´ìš©ì„ ì½ì–´ 'draft: true'ì™€ ê°™ì€ ë§ˆì»¤ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
          IS_DRAFT=$(grep -q 'draft: true' "${GITHUB_WORKSPACE}/${{ github.event.commits[0].added[0] }}")
          if [ $? -eq 0 ]; then
            echo "is_draft=true" >> "$GITHUB_OUTPUT"
          else
            echo "is_draft=false" >> "$GITHUB_OUTPUT"
          fi

      - name: Send Discord notification
        if: steps.check_draft.outputs.is_draft == 'false'
        uses: appleboy/discord-action@1.4.1
        with:
          webhook_url: ${{ secrets.DISCORD_WEBHOOK_URL }}
          message: |
            ğŸ“¢ ìƒˆë¡œìš´ ê¸€ì´ ê²Œì‹œë˜ì—ˆìŠµë‹ˆë‹¤!
            ì œëª©: ${{ github.event.commits[0].message }}
            ë§í¬: ${{ github.event.repository.html_url }}/blob/${{ github.event.before }}/${{ github.event.commits[0].added[0] }}
